FROM python:3.11-slim

WORKDIR /app

RUN pip install --no-cache-dir uv

COPY pyproject.toml ./
RUN uv pip install --system --no-cache -r pyproject.toml && \
    uv pip install --system --no-cache pytest pytest-asyncio httpx hypothesis

COPY src ./src
COPY alembic ./alembic
COPY alembic.ini ./
COPY tests ./tests

ENV PYTHONUNBUFFERED=1

CMD ["pytest", "tests/integration/", "-v"]
